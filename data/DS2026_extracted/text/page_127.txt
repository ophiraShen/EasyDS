第4章串
115
第5个字符失配时，模式串的下次比较位置为2，即next[5]=2，相当于向右滑动3位。
匹配失败，说明此元素不是c
主串
h
模式串
a1
b2
C3
a
C5
右滑
a
b2
next数组和PM表的关系是怎样的?
通过上述举例，可以推理出next数组和PM表之间的关系：
next[j］=j-右滑位数=j-(已匹配的字符数-对应的部分匹配值)
=j-[(j-1）-PM[j-1]]
=PM[j-1]+1
根据上述结论，将模式串，abcac+的PM表右移一位，并整体加1，就得到了模式串+abcac
对应的next数组，通过与前面手算的结果比较，可以验证上述结论。
编号
1
2
3
4
S
a
b
C
a
next
0
1
1
2
我们注意到：
1）第一个元素右滑以后空缺的用0来填充，因为若是第一个元素匹配失败，则需要将主串
指针和模式串指针同步右移一位，从而不需要计算模式串指针移动的位数。
2）最后一个元素在右滑的过程中溢出，因为原来的模式串中，最后一个元素的部分匹配值
是其下一个元素使用的，但显然已没有下一个元素，所以可以舍去。
注
意
上述KMP算法的举例中，都假设串的编号是从1开始的；若串的编号是从0开始的，则next数
组需要整体减1。
*3.next数组的推理公式
第1个字符与模式串的第个字符失配时，应让主串当前位置与模式串的哪个字符进行比较？
假设此时应与模式串的第k（k<j）个字符进行比较，则模式串的前k-1个字符的子串必须
满足下列条件，且不可能存在k'>k满足下列条件：
'p1p2.pk-1'='pj-k+1Pj-k+2..·pj-1'
若存在满足如上条件的子串，则发生失配时，仅需将模式串的第k个字符和主串的第i个字
符对齐，此时模式串的前k-1个字符的子串必定与主串的第i个字符之前长度为k-1的子串相
等，因此，只需从模式串的第k个字符与主串的第i个字符进行比较即可，如图4.3所示。
主串
S1
Si-k+1
Si-1
#
S
子串
P1
pk-1
Pj-k+1
Pj-1
Pm
右滑
P1
...
Pk-1pk
Pm
图4.3模式串右滑到合适位置（阴影对齐部分表示上下字符相等）
①注意，当模式串匹配到位置j失配时，已匹配成功的字符数为j-1。
